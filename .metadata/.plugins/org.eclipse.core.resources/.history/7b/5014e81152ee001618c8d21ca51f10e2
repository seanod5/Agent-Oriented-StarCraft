agent TerranCommandCenter {
	module EIS eis;
	module Console C;
	module System S;
	module Prelude P;
	
	types model {
		formula minerals(int);
		formula gas(int);
		formula currentSupply(int);	//Number of units currently alive
		formula totalSupply(int);	//Number of units the player can have
		formula queueSize(int);
	}
	
	initial minerals(50);
	initial gas(0);
	initial currentSupply(4);
	initial totalSupply(10);
	initial queueSize(0);	//Not sure if these values should be hardcoded or if I should use a flag at the start of the game
	initial !init();		//I could just call !init() in the mineral check event ^^^
	
	rule +!init() {
		eis.join("starcraft");
		eis.link();
		C.println("Command Center online.");
		
		while(true) {
			!trainSCV();
		}
	}
	
	rule +!trainSCV() : minerals(int minerals) & currentSupply(int CS) & totalSupply(int TS) {
		if((minerals >= 50) & (CS <= TS)) {
			//C.println("Deploying SCV");
			eis.train("Terran SCV");
			//list temp = eis.freeEntities();
			//S.createAgent(P.headAsString(temp), "TerranSCV");
		}
	}
	
	rule +!trainSCV() {
		!trainSCV();
	}
	
	rule +$eis.event(resources(int minerals, int gas, int CS, int TS)) : minerals(int prevM) & gas(int prevG) & currentSupply(int prevCS) & totalSupply(int prevTS) {
		if(prevCS == prevTS) {
			send(inform, "manager", content("Supply Request"));
			C.println("Supply Request sent.");
		}
		
		-minerals(prevM);
		-gas(prevG);
		-currentSupply(prevCS);
		-totalSupply(prevTS);
		+minerals(minerals);
		+gas(gas);
		+currentSupply(CS);
		+totalSupply(TS);
	}
	
	rule +$eis.event(queueSize(int size)) : queueSize(int prevSize) {
		-queueSize(prevSize);
		+queueSize(size);
	}
}